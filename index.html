<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">Emulation's Proxy</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iIzAwMDEyMCIvPjxwYXRoIGQ9Ik01MCA1MGEzNSAzNSAwIDEgMCAwIDcwIDM1IDM1IDAgMCAwIDAgLTcwWiIgZmlsbD0iIzRhN2NiNyIgb3BhY2l0eT0iMC43Ii8+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iMTAiIGZpbGw9IiNmZmZmZmYiIHN0cm9rZT0iIzlmN2FlYSIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggZD0iTTY1IDUwYTUgNSAwIDEgMCAwIDEwIDUgNSAwIDAgMCAwIC0xMFoiIGZpbGw9IiNmZjZiNmIiLz48L3N2Zz4=">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.12.4/dist/sweetalert2.all.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    body {
      background: linear-gradient(180deg, #0a0a0a, #1a1a1a);
      overflow-x: hidden;
    }
    #particles-js {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -10;
    }
    #three-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -9;
      opacity: 0.6;
    }
    .control-panel {
      background: rgba(15, 15, 15, 0.95);
      border: 1px solid rgba(75, 108, 183, 0.4);
      border-radius: 12px;
      box-shadow: 0 0 40px rgba(75, 108, 183, 0.3);
      animation: cosmicPulse 2s infinite ease-in-out;
    }
    .top-bar {
      background: linear-gradient(145deg, #1a1a3a, #0a0a1a);
      border-bottom: 2px solid rgba(75, 108, 183, 0.5);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.7);
      border-radius: 0 0 12px 12px;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .tab {
      background: rgba(40, 40, 40, 0.85);
      border-radius: 8px;
      transition: all 0.3s ease;
      position: relative;
      padding: 0.5rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .tab:hover {
      background: rgba(75, 108, 183, 0.6);
      transform: translateY(-2px);
    }
    .tab.active {
      background: linear-gradient(145deg, #4b6cb7, #182848);
      box-shadow: 0 0 25px rgba(75, 108, 183, 0.8), 0 0 10px rgba(159, 122, 234, 0.5);
    }
    .tab.loading::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(75, 108, 183, 0.4), transparent);
      animation: loadingGlow 1.2s infinite;
    }
    @keyframes loadingGlow {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    .btn-cosmic {
      background: linear-gradient(145deg, #4b6cb7, #182848);
      box-shadow: 0 0 15px rgba(75, 108, 183, 0.8), 0 0 30px rgba(75, 108, 183, 0.4);
      transition: all 0.3s ease;
      animation: cosmicPulse 1.5s infinite ease-in-out;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .btn-cosmic:hover {
      box-shadow: 0 0 25px rgba(75, 108, 183, 1), 0 0 40px rgba(75, 108, 183, 0.6);
      transform: scale(1.05);
    }
    @keyframes cosmicPulse {
      0% { box-shadow: 0 0 15px rgba(75, 108, 183, 0.8); }
      50% { box-shadow: 0 0 25px rgba(75, 108, 183, 0.4); }
      100% { box-shadow: 0 0 15px rgba(75, 108, 183, 0.8); }
    }
    .error-message {
      background: rgba(255, 0, 0, 0.25);
      border: 1px solid #ff4d4d;
      animation: shake 0.3s ease;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    .notification {
      background: rgba(75, 108, 183, 0.9);
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(75, 108, 183, 0.5);
      animation: slideIn 0.5s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .loader {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      display: none;
    }
    .loader svg {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="text-gray-200 min-h-screen flex flex-col">
  <div id="particles-js"></div>
  <canvas id="three-canvas"></canvas>
  <div class="top-bar fixed top-0 left-0 w-full z-20">
    <div class="flex space-x-2">
      <div id="tabs" class="flex space-x-2"></div>
      <button id="newTabBtn" class="btn-cosmic text-white px-4 py-2 rounded-lg"><i class="fas fa-plus"></i> New Tab</button>
    </div>
    <button id="settingsBtn" class="btn-cosmic text-white px-4 py-2 rounded-lg"><i class="fas fa-cog"></i></button>
  </div>
  <div class="max-w-5xl mx-auto p-8 w-full mt-20 z-10">
    <h1 class="text-5xl font-extrabold mb-8 text-center bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500 flex items-center justify-center">
      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iIzAwMDEyMCIvPjxwYXRoIGQ9Ik01MCA1MGEzNSAzNSAwIDEgMCAwIDcwIDM1IDM1IDAgMCAwIDAgLTcwWiIgZmlsbD0iIzRhN2NiNyIgb3BhY2l0eT0iMC43Ii8+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iMTAiIGZpbGw9IiNmZmZmZmYiIHN0cm9rZT0iIzlmN2FlYSIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggZD0iTTY1IDUwYTUgNSAwIDEgMCAwIDEwIDUgNSAwIDAgMCAwIC0xMFoiIGZpbGw9IiNmZjZiNmIiLz48L3N2Zz4=" class="w-12 h-12 mr-2">
      Emulation's Proxy
    </h1>
    <div class="control-panel p-8 mb-8">
      <div class="flex flex-col sm:flex-row sm:space-x-4 space-y-4 sm:space-y-0">
        <input 
          id="urlInput" 
          type="text" 
          placeholder="Enter URL (e.g., example.com)" 
          class="flex-1 border border-gray-600 p-3 rounded-lg bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-200 placeholder-gray-400"
        >
        <button id="submitBtn" class="btn-cosmic text-white p-3 rounded-lg"><i class="fas fa-play"></i> Go</button>
        <button id="fullscreenBtn" class="btn-cosmic text-white p-3 rounded-lg"><i class="fas fa-expand"></i> Full Screen</button>
      </div>
      <div id="error" class="error-message hidden text-center mt-4 p-2 rounded-lg"></div>
      <div id="settingsPanel" class="hidden mt-6 p-4 bg-gray-800 rounded-lg">
        <h2 class="text-lg font-bold mb-4 text-blue-400"><i class="fas fa-cog mr-2"></i> Settings</h2>
        <div class="space-y-4">
          <label class="flex items-center">
            <input id="cloakToggle" type="checkbox" class="mr-2">
            <span><i class="fas fa-mask mr-2"></i> Enable Tab Cloaking</span>
          </label>
          <input id="cloakTitle" type="text" placeholder="Custom Page Title" class="w-full border border-gray-600 p-2 rounded-lg bg-gray-700 text-gray-200">
          <input id="cloakFavicon" type="text" placeholder="Favicon URL" class="w-full border border-gray-600 p-2 rounded-lg bg-gray-700 text-gray-200">
          <input id="panicUrl" type="text" placeholder="Panic Button URL" value="https://www.youtube.com/@Emulation12" class="w-full border border-gray-600 p-2 rounded-lg bg-gray-700 text-gray-200">
          <button id="panicBtn" class="btn-cosmic text-white p-2 rounded-lg w-full"><i class="fas fa-ban mr-2"></i> Trigger Panic</button>
          <button id="cloakBtn" class="btn-cosmic text-white p-2 rounded-lg w-full"><i class="fas fa-eye-slash mr-2"></i> Open in About:Blank</button>
          <select id="themeSelect" class="w-full border border-gray-600 p-2 rounded-lg bg-gray-700 text-gray-200">
            <option value="dark">Dark</option>
            <option value="nebula">Nebula</option>
            <option value="starfield">Starfield</option>
          </select>
          <label class="block"><i class="fas fa-shapes mr-2"></i> Particle Effect</label>
          <select id="particleType" class="w-full border border-gray-600 p-2 rounded-lg bg-gray-700 text-gray-200">
            <option value="circle">Circle</option>
            <option value="star">Star</option>
            <option value="triangle">Triangle</option>
            <option value="edge">Edge</option>
            <option value="nebula-cloud">Nebula Cloud</option>
            <option value="cosmic-dust">Cosmic Dust</option>
          </select>
          <label class="block"><i class="fas fa-tachometer-alt mr-2"></i> Particle Density</label>
          <input id="particleDensity" type="range" min="50" max="300" value="120" class="w-full">
          <label class="block"><i class="fas fa-tachometer-alt mr-2"></i> Particle Speed</label>
          <input id="particleSpeed" type="range" min="2" max="15" value="4" class="w-full">
          <label class="block"><i class="fas fa-palette mr-2"></i> Particle Color</label>
          <input id="particleColor" type="color" value="#4b6cb7" class="w-full h-10 border border-gray-600 rounded-lg bg-gray-700">
          <label class="block"><i class="fas fa-adjust mr-2"></i> Background Opacity</label>
          <input id="bgOpacity" type="range" min="0.3" max="1" step="0.1" value="0.6" class="w-full">
          <label class="block"><i class="fas fa-bolt mr-2"></i> Animation Intensity</label>
          <input id="animIntensity" type="range" min="0.5" max="2" step="0.1" value="1" class="w-full">
          <label class="block"><i class="fas fa-redo mr-2"></i> Proxy Retry Attempts</label>
          <input id="proxyRetries" type="number" min="1" max="5" value="2" class="w-full border border-gray-600 p-2 rounded-lg bg-gray-700 text-gray-200">
          <label class="flex items-center">
            <input id="ambientSound" type="checkbox" class="mr-2">
            <span><i class="fas fa-volume-up mr-2"></i> Enable Ambient Sound</span>
          </label>
        </div>
      </div>
      <div id="aboutPanel" class="hidden mt-6 p-4 bg-gray-800 rounded-lg">
        <h2 class="text-lg font-bold mb-4 text-blue-400"><i class="fas fa-info-circle mr-2"></i> About Emulation's Proxy</h2>
        <div class="space-y-4 text-gray-300">
          <p><strong>Emulation's Proxy</strong> is a cosmic-themed proxy website designed for seamless web access with a futuristic interface.</p>
          <ul class="list-disc pl-5">
            <li><strong>Proxy Access</strong>: Load websites via a proxy (allorigins.win) by entering a URL and clicking Go.</li>
            <li><strong>Tab Cloaking</strong>: Disguise the page title and favicon for privacy (customize in Settings).</li>
            <li><strong>Panic Button</strong>: Instantly redirect to a safe URL (default: YouTube) with the Escape key or Panic button.</li>
            <li><strong>Visuals</strong>: Enjoy Three.js black hole/planet animations and customizable particle effects (circle, star, triangle, edge, nebula-cloud, cosmic-dust).</li>
            <li><strong>Themes</strong>: Switch between Dark, Nebula, and Starfield themes.</li>
            <li><strong>Ambient Sound</strong>: Toggle space-themed audio for immersion.</li>
            <li><strong>Socials</strong>: Connect with us on <a href="https://www.youtube.com/@Emulation12" target="_blank" class="text-blue-400 hover:underline"><i class="fab fa-youtube mr-1"></i> YouTube (@Emulation12)</a>.</li>
          </ul>
          <p>Explore the cosmos while browsing securely!</p>
        </div>
      </div>
    </div>
    <div class="relative rounded-lg overflow-hidden">
      <div id="loader" class="loader">
        <svg width="64" height="64" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
          <g fill="none" fill-rule="evenodd" stroke-width="2">
            <circle cx="22" cy="22" r="20" stroke="#4b6cb7" stroke-opacity=".3"/>
            <circle cx="22" cy="22" r="20" stroke="#9f7aea" stroke-dasharray="90" stroke-dashoffset="60">
              <animateTransform attributeName="transform" type="rotate" from="0 22 22" to="360 22 22" dur="1s" repeatCount="indefinite"/>
            </circle>
          </g>
        </svg>
      </div>
      <iframe id="contentFrame" class="w-full h-[700px] border-0"></iframe>
    </div>
    <div id="notification" class="notification hidden fixed bottom-4 right-4 p-4 text-white"></div>
  </div>
  <!-- Space Ambience sound from Pixabay: https://pixabay.com/sound-effects/space-ambience-140799/ by freesound_community, CC0 -->
  <audio id="ambientAudio" loop>
    <source src="https://cdn.pixabay.com/audio/2023/04/13/03-14-34-650_140799.mp3" type="audio/mpeg">
    <source src="https://www.zapsplat.com/wp-content/uploads/2015/sound-effects-77338/zapsplat_science_fiction_ambience_space_distant_planets_001_77338.mp3" type="audio/mpeg">
  </audio>
  <script>
    // Sanitize string to prevent injection
    function sanitize(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    // Initialize particles.js
    function initParticles(theme, density = 120, speed = 4, type = 'circle', color = '#4b6cb7') {
      const configs = {
        dark: {
          particles: { number: { value: density, density: { enable: true, value_area: 1000 } }, color: { value: color }, shape: { type }, opacity: { value: 0.6, random: true }, size: { value: 3, random: true }, line_linked: { enable: true, distance: 100, color, opacity: 0.4, width: 1 }, move: { enable: true, speed, direction: 'none', random: true } },
          interactivity: { detect_on: 'canvas', events: { onhover: { enable: true, mode: 'grab' }, onclick: { enable: true, mode: 'push' } }, modes: { grab: { distance: 150, line_linked: { opacity: 0.7 } }, push: { particles_nb: 4 } } },
          retina_detect: true
        },
        nebula: {
          particles: { number: { value: density, density: { enable: true, value_area: 1000 } }, color: { value: color }, shape: { type }, opacity: { value: 0.7, random: true }, size: { value: 4, random: true }, line_linked: { enable: true, distance: 150, color, opacity: 0.5, width: 1.5 }, move: { enable: true, speed, direction: 'none', random: true } },
          interactivity: { detect_on: 'canvas', events: { onhover: { enable: true, mode: 'bubble' }, onclick: { enable: true, mode: 'repulse' } }, modes: { bubble: { distance: 200, size: 5, duration: 2 }, repulse: { distance: 100 } } },
          retina_detect: true
        },
        starfield: {
          particles: { number: { value: density, density: { enable: true, value_area: 1000 } }, color: { value: color }, shape: { type }, opacity: { value: 0.8, random: true }, size: { value: 2, random: true }, line_linked: { enable: false }, move: { enable: true, speed, direction: 'random', random: true } },
          interactivity: { detect_on: 'canvas', events: { onhover: { enable: true, mode: 'grab' }, onclick: { enable: true, mode: 'push' } }, modes: { grab: { distance: 150, line_linked: { opacity: 0.7 } }, push: { particles_nb: 4 } } },
          retina_detect: true
        },
        'nebula-cloud': {
          particles: { number: { value: density / 2, density: { enable: true, value_area: 1500 } }, color: { value: color }, shape: { type }, opacity: { value: 0.5, random: true }, size: { value: 5, random: true }, line_linked: { enable: true, distance: 200, color, opacity: 0.3, width: 2 }, move: { enable: true, speed: speed / 2, direction: 'none', random: true, attract: { enable: true, rotateX: 600, rotateY: 1200 } } },
          interactivity: { detect_on: 'canvas', events: { onhover: { enable: true, mode: 'bubble' }, onclick: { enable: true, mode: 'push' } }, modes: { bubble: { distance: 300, size: 8, duration: 3 }, push: { particles_nb: 2 } } },
          retina_detect: true
        },
        'cosmic-dust': {
          particles: { number: { value: density / 3, density: { enable: true, value_area: 2000 } }, color: { value: color }, shape: { type }, opacity: { value: 0.4, random: true, anim: { enable: true, speed: 1, opacity_min: 0.1 } }, size: { value: 2, random: true }, line_linked: { enable: false }, move: { enable: true, speed: speed / 3, direction: 'random', random: true } },
          interactivity: { detect_on: 'canvas', events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' } }, modes: { repulse: { distance: 150 }, push: { particles_nb: 3 } } },
          retina_detect: true
        }
      };
      particlesJS('particles-js', configs[theme]);
    }
    initParticles('dark');

    // Initialize Three.js for black hole, planets, and asteroids
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas'), alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.position.z = 50;

    // Black hole
    const discGeometry = new THREE.RingGeometry(5, 15, 32);
    const discMaterial = new THREE.MeshBasicMaterial({ color: 0x0a0a0a, side: THREE.DoubleSide });
    const blackHole = new THREE.Mesh(discGeometry, discMaterial);
    scene.add(blackHole);
    gsap.to(blackHole.rotation, { z: '+=6.28', duration: 10, repeat: -1, ease: 'linear' });

    // Planets and asteroids
    const objects = [];
    for (let i = 0; i < 6; i++) {
      const isPlanet = i < 3;
      const geometry = new THREE.SphereGeometry(isPlanet ? 1 + Math.random() * 2 : 0.5 + Math.random(), 32, 32);
      const material = new THREE.MeshBasicMaterial({ color: ['#4b6cb7', '#9f7aea', '#ff6b6b', '#00cc99', '#ffcc00', '#66ffcc'][i] });
      const obj = new THREE.Mesh(geometry, material);
      obj.position.set((Math.random() - 0.5) * 40, (Math.random() - 0.5) * 20, isPlanet ? -10 : -15);
      scene.add(obj);
      objects.push(obj);
      gsap.to(obj.position, { x: `+=${10 + Math.random() * 20}`, duration: isPlanet ? 5 + Math.random() * 5 : 3 + Math.random() * 3, repeat: -1, yoyo: true, ease: 'sine.inOut' });
    }

    // Animation loop
    function animateThree() {
      requestAnimationFrame(animateThree);
      renderer.render(scene, camera);
    }
    animateThree();

    // DOM elements
    const urlInput = document.getElementById('urlInput');
    const submitBtn = document.getElementById('submitBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const cloakBtn = document.getElementById('cloakBtn');
    const panicBtn = document.getElementById('panicBtn');
    const errorDiv = document.getElementById('error');
    const contentFrame = document.getElementById('contentFrame');
    const tabsDiv = document.getElementById('tabs');
    const settingsPanel = document.getElementById('settingsPanel');
    const aboutPanel = document.getElementById('aboutPanel');
    const settingsBtn = document.getElementById('settingsBtn');
    const newTabBtn = document.getElementById('newTabBtn');
    const cloakToggle = document.getElementById('cloakToggle');
    const cloakTitle = document.getElementById('cloakTitle');
    const cloakFavicon = document.getElementById('cloakFavicon');
    const panicUrlInput = document.getElementById('panicUrl');
    const themeSelect = document.getElementById('themeSelect');
    const particleDensity = document.getElementById('particleDensity');
    const particleSpeed = document.getElementById('particleSpeed');
    const particleType = document.getElementById('particleType');
    const particleColor = document.getElementById('particleColor');
    const bgOpacity = document.getElementById('bgOpacity');
    const animIntensity = document.getElementById('animIntensity');
    const proxyRetries = document.getElementById('proxyRetries');
    const notification = document.getElementById('notification');
    const ambientAudio = document.getElementById('ambientAudio');
    const loader = document.getElementById('loader');
    let tabs = [
      { id: 'new-tab', url: null, content: `
        <div class="p-8 text-center text-gray-200">
          <h2 class="text-3xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">Welcome to Emulation's Proxy</h2>
          <p>Enter a URL above to start browsing, or explore the About tab to learn more!</p>
        </div>`, label: 'New Tab', type: 'new-tab', icon: 'fas fa-home' },
      { id: 'about', url: null, content: null, label: 'About', type: 'about', icon: 'fas fa-info-circle' }
    ];

    // Theme management
    function applyTheme(theme) {
      const backgrounds = {
        dark: 'linear-gradient(180deg, #0a0a0a, #1a1a1a)',
        nebula: 'linear-gradient(180deg, #1a0033, #330066)',
        starfield: 'linear-gradient(180deg, #000000, #0a0a1a)'
      };
      document.body.style.background = backgrounds[theme];
      document.querySelector('#three-canvas').style.opacity = parseFloat(bgOpacity.value);
      gsap.to('.btn-cosmic, .control-panel, .tab.active', { animationDuration: parseFloat(animIntensity.value) * 1.5, duration: 0.3 });
      initParticles(theme, parseInt(particleDensity.value), parseInt(particleSpeed.value), particleType.value, particleColor.value);
    }
    themeSelect.addEventListener('change', () => applyTheme(themeSelect.value));
    particleDensity.addEventListener('input', () => applyTheme(themeSelect.value));
    particleSpeed.addEventListener('input', () => applyTheme(themeSelect.value));
    particleType.addEventListener('change', () => applyTheme(themeSelect.value));
    particleColor.addEventListener('input', () => applyTheme(themeSelect.value));
    bgOpacity.addEventListener('input', () => applyTheme(themeSelect.value));
    animIntensity.addEventListener('input', () => applyTheme(themeSelect.value));
    applyTheme('dark');

    // Ambient sound toggle
    document.getElementById('ambientSound').addEventListener('change', (e) => {
      if (e.target.checked) {
        ambientAudio.play().catch(err => {
          errorDiv.textContent = `Failed to play ambient sound: ${err.message}`;
          errorDiv.classList.remove('hidden');
          gsap.from(errorDiv, { opacity: 0, y: 10, duration: 0.5 });
        });
      } else {
        ambientAudio.pause();
      }
    });

    // Tab cloaking
    function updateCloaking() {
      if (cloakToggle.checked) {
        document.getElementById('pageTitle').textContent = cloakTitle.value || "Emulation's Proxy";
        document.getElementById('favicon').href = cloakFavicon.value || 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iIzAwMDEyMCIvPjxwYXRoIGQ9Ik01MCA1MGEzNSAzNSAwIDEgMCAwIDcwIDM1IDM1IDAgMCAwIDAgLTcwWiIgZmlsbD0iIzRhN2NiNyIgb3BhY2l0eT0iMC43Ii8+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iMTAiIGZpbGw9IiNmZmZmZmYiIHN0cm9rZT0iIzlmN2FlYSIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggZD0iTTY1IDUwYTUgNSAwIDEgMCAwIDEwIDUgNSAwIDAgMCAwIC0xMFoiIGZpbGw9IiNmZjZiNmIiLz48L3N2Zz4=';
      } else {
        document.getElementById('pageTitle').textContent = "Emulation's Proxy";
        document.getElementById('favicon').href = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iIzAwMDEyMCIvPjxwYXRoIGQ9Ik01MCA1MGEzNSAzNSAwIDEgMCAwIDcwIDM1IDM1IDAgMCAwIDAgLTcwWiIgZmlsbD0iIzRhN2NiNyIgb3BhY2l0eT0iMC43Ii8+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iMTAiIGZpbGw9IiNmZmZmZmYiIHN0cm9rZT0iIzlmN2FlYSIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggZD0iTTY1IDUwYTUgNSAwIDEgMCAwIDEwIDUgNSAwIDAgMCAwIC0xMFoiIGZpbGw9IiNmZjZiNmIiLz48L3N2Zz4=';
      }
    }
    cloakToggle.addEventListener('change', updateCloaking);
    cloakTitle.addEventListener('input', updateCloaking);
    cloakFavicon.addEventListener('input', updateCloaking);

    // Settings toggle
    settingsBtn.addEventListener('click', () => {
      const isHidden = settingsPanel.classList.contains('hidden');
      settingsPanel.classList.toggle('hidden');
      aboutPanel.classList.add('hidden');
      gsap.fromTo(settingsPanel, 
        { opacity: isHidden ? 0 : 1, y: isHidden ? -20 : 0 }, 
        { opacity: isHidden ? 1 : 0, y: isHidden ? 0 : -20, duration: 0.3 }
      );
    });

    // Add tab
    function addTab(id, url, content, label, type = 'proxy', icon = 'fas fa-globe') {
      tabs = tabs.filter(t => t.url !== url || t.type !== 'proxy');
      tabs.push({ id, url, content, label, type, icon });
      renderTabs();
    }

    // Render tabs
    function renderTabs() {
      tabsDiv.innerHTML = '';
      tabs.forEach(tab => {
        const tabBtn = document.createElement('button');
        tabBtn.className = `tab text-gray-200 px-4 py-2 rounded-lg ${tab.id === tabsDiv.dataset.active ? 'active' : ''}`;
        tabBtn.innerHTML = `<i class="${tab.icon} mr-2"></i>${sanitize(tab.label)}`;
        const closeBtn = document.createElement('span');
        closeBtn.textContent = ' Ã—';
        closeBtn.className = 'ml-2 text-red-400 cursor-pointer';
        closeBtn.onclick = (e) => {
          e.stopPropagation();
          tabs = tabs.filter(t => t.id !== tab.id);
          if (tab.id === tabsDiv.dataset.active) {
            contentFrame.srcdoc = '';
            settingsPanel.classList.add('hidden');
            aboutPanel.classList.add('hidden');
          }
          renderTabs();
        };
        tabBtn.appendChild(closeBtn);
        tabBtn.onclick = () => {
          tabsDiv.dataset.active = tab.id;
          if (tab.type === 'proxy' && tab.content) {
            contentFrame.srcdoc = tab.content;
            contentFrame.classList.remove('hidden');
            settingsPanel.classList.add('hidden');
            aboutPanel.classList.add('hidden');
          } else if (tab.type === 'about') {
            contentFrame.classList.add('hidden');
            settingsPanel.classList.add('hidden');
            aboutPanel.classList.remove('hidden');
          } else if (tab.type === 'new-tab') {
            contentFrame.srcdoc = tab.content;
            contentFrame.classList.remove('hidden');
            settingsPanel.classList.add('hidden');
            aboutPanel.classList.add('hidden');
          }
          renderTabs();
          anime({
            targets: tabBtn,
            scale: [0.9, 1],
            duration: 300,
            easing: 'easeOutQuad'
          });
        };
        tabsDiv.appendChild(tabBtn);
        if (tab.id === tabsDiv.dataset.active) {
          tabBtn.classList.add('active');
          anime({
            targets: tabBtn,
            scale: [0.9, 1],
            duration: 300,
            easing: 'easeOutQuad'
          });
        }
      });
    }
    renderTabs();

    // New tab button
    newTabBtn.addEventListener('click', () => {
      addTab(Date.now().toString(), null, `
        <div class="p-8 text-center text-gray-200">
          <h2 class="text-3xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">Welcome to Emulation's Proxy</h2>
          <p>Enter a URL above to start browsing, or explore the About tab to learn more!</p>
        </div>`, 'New Tab', 'new-tab', 'fas fa-home');
    });

    // About:Blank cloaking
    cloakBtn.addEventListener('click', () => {
      try {
        const currentContent = encodeURIComponent(contentFrame.srcdoc || '');
        if (currentContent) {
          const newWindow = window.open('about:blank', '_blank');
          newWindow.document.write(`
            <!DOCTYPE html>
            <html>
              <head><title>${sanitize(cloakToggle.checked ? cloakTitle.value : "Emulation's Proxy")}</title></head>
              <body style="margin:0;overflow:hidden;">
                <iframe srcdoc="${currentContent}" style="width:100%;height:100vh;border:0;"></iframe>
              </body>
            </html>
          `);
          newWindow.document.close();
          Swal.fire({
            title: 'Success',
            text: 'Content opened in About:Blank',
            icon: 'success',
            timer: 1500,
            showConfirmButton: false,
            background: '#1a1a1a',
            color: '#fff'
          });
        } else {
          errorDiv.textContent = 'No content to cloak';
          errorDiv.classList.remove('hidden');
          gsap.from(errorDiv, { opacity: 0, y: 10, duration: 0.5 });
        }
      } catch (err) {
        errorDiv.textContent = `Failed to open About:Blank: ${err.message}`;
        errorDiv.classList.remove('hidden');
        gsap.from(errorDiv, { opacity: 0, y: 10, duration: 0.5 });
      }
    });

    // Panic button
    function triggerPanic() {
      window.location.href = panicUrlInput.value || 'https://www.youtube.com/@Emulation12';
    }
    panicBtn.addEventListener('click', triggerPanic);
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') triggerPanic();
    });

    // Full screen
    fullscreenBtn.addEventListener('click', () => {
      if (contentFrame.requestFullscreen) {
        contentFrame.requestFullscreen();
      } else if (contentFrame.webkitRequestFullscreen) {
        contentFrame.webkitRequestFullscreen();
      } else if (contentFrame.msRequestFullscreen) {
        contentFrame.msRequestFullscreen();
      }
      Swal.fire({
        title: 'Full Screen',
        text: 'Entered full-screen mode',
        icon: 'info',
        timer: 1500,
        showConfirmButton: false,
        background: '#1a1a1a',
        color: '#fff'
      });
    });

    // Handle proxy request
    async function fetchWithRetries(url, retries) {
      for (let i = 0; i < retries; i++) {
        try {
          const response = await fetch(url);
          if (response.ok) return response;
          throw new Error(`HTTP error ${response.status}`);
        } catch (err) {
          if (i === retries - 1) throw err;
        }
      }
    }
    submitBtn.addEventListener('click', async () => {
      let url = urlInput.value.trim();
      errorDiv.classList.add('hidden');
      contentFrame.classList.add('hidden');
      settingsPanel.classList.add('hidden');
      aboutPanel.classList.add('hidden');
      loader.style.display = 'block';

      if (!url) {
        errorDiv.textContent = 'Please enter a URL';
        errorDiv.classList.remove('hidden');
        gsap.from(errorDiv, { opacity: 0, y: 10, duration: 0.5 });
        loader.style.display = 'none';
        return;
      }

      if (!url.match(/^https?:\/\//)) {
        url = 'https://' + url;
      }
      if (!url.match(/^https?:\/\/.+/)) {
        errorDiv.textContent = 'Invalid URL format';
        errorDiv.classList.remove('hidden');
        gsap.from(errorDiv, { opacity: 0, y: 10, duration: 0.5 });
        loader.style.display = 'none';
        return;
      }

      const hostname = new URL(url).hostname;
      notification.textContent = `Going to ${sanitize(hostname)}`;
      notification.classList.remove('hidden');
      gsap.fromTo(notification, { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.5 });
      gsap.to(notification, { opacity: 0, delay: 2, duration: 0.5, onComplete: () => notification.classList.add('hidden') });

      const tabId = Date.now().toString();
      tabsDiv.dataset.active = tabId;
      const tabBtn = document.createElement('button');
      tabBtn.className = 'tab text-gray-200 px-4 py-2 rounded-lg loading';
      tabBtn.innerHTML = `<img src="https://www.google.com/s2/favicons?domain=${hostname}" class="w-5 h-5 mr-2" alt="Favicon">${sanitize(hostname)}`;
      tabsDiv.appendChild(tabBtn);
      anime({
        targets: tabBtn,
        scale: [0.9, 1],
        duration: 300,
        easing: 'easeOutQuad'
      });

      try {
        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
        const response = await fetchWithRetries(proxyUrl, parseInt(proxyRetries.value));
        const data = await response.text();
        contentFrame.srcdoc = data;
        contentFrame.classList.remove('hidden');
        addTab(tabId, url, data, hostname, 'proxy', `<img src="https://www.google.com/s2/favicons?domain=${hostname}" class="w-5 h-5" alt="Favicon">`);
        anime({
          targets: contentFrame,
          opacity: [0, 1],
          scale: [0.95, 1],
          duration: 500,
          easing: 'easeOutQuad'
        });
        Swal.fire({
          title: 'Success',
          text: `Loaded ${sanitize(hostname)}`,
          icon: 'success',
          timer: 1500,
          showConfirmButton: false,
          background: '#1a1a1a',
          color: '#fff'
        });
      } catch (err) {
        errorDiv.textContent = `Error: ${err.message}. Try another URL or use a custom proxy server.`;
        errorDiv.classList.remove('hidden');
        gsap.from(errorDiv, { opacity: 0, y: 10, duration: 0.5 });
        tabs = tabs.filter(t => t.id !== tabId);
        renderTabs();
        Swal.fire({
          title: 'Error',
          text: err.message,
          icon: 'error',
          timer: 2000,
          showConfirmButton: false,
          background: '#1a1a1a',
          color: '#fff'
        });
      } finally {
        loader.style.display = 'none';
      }
    });

    // Keyboard shortcuts
    urlInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') submitBtn.click();
    });
  </script>
</body>
</html>
